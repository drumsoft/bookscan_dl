# bookscan_dl.pl

bookscan_dl.pl - ブックスキャンのマイページから電子書籍ファイルをダウンロードする

## インストールと設定

1. perl モジュールをインストールする。

	```
	sudo cpanm --installdeps .
	```

2. bookscan_dl.pl を初回実行すると設定ファイルのテンプレート bookscan_dl.yml が作成される。

	```
	./bookscan_dl.pl
	```

3. bookscan_dl.yml を開いて編集する。

	```
	---
	bookscan:
	  account: 'ブックスキャンアカウントのメールアドレス'
	  password: 'ブックスキャンアカウントのパスワード'
	local:
	  path: 'ダウンロード先フォルダのパス'
	ua: 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)'
	```

4. bookscan_dl.pl を cron とか launchd などで自動実行する設定にする。

	* 毎日とか毎週とかのスケジュールが良い。

## 運用

* bookscan_dl.pl は下記の場合に何かメッセージを（標準出力に）出力するので、メールなどで受け取れる様にしておく。
	* 新規電子書籍ファイルをダウンロードした時
	* 何か問題が起きた時

## 詳細

* ダウンロードの対象となるのはマイページの書籍一覧（リストモード、スキャン順）で最初のページに表示されるもの。
* スキャンしなおし等でリモート側のファイルサイズが変更になっていた場合、書籍ファイルが再度ダウンロードされる。再ダウンロードのための変更チェック（ファイルサイズが変更されたかのチェック）はファイルのダウンロードから10日間行われる。
* bookscan_dl-downloaded.yml というファイルが作られ、ダウンロード結果（ダウンロード日時、ファイルサイズ）が保存される。
